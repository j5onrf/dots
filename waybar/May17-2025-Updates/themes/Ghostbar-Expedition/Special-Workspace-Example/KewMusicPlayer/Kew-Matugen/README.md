---

![FullScreen-2025-06-14_08-38-34](https://github.com/user-attachments/assets/20de9d3d-c60d-420f-b34c-decb6dc128ac)

# Dynamic Kewmusicplayer Theming (Hyprland)

This setup allows `kewmusicplayer` to dynamically match your Hyprland desktop's color scheme, generated by `matugen` from your current wallpaper.

**Note:** `kew` uses a limited 8-color terminal palette, so `matugen`'s hex colors are converted to their closest ANSI equivalents.

## How It Works

1.  Your `wallpaper.sh` script sets the wallpaper and triggers `matugen`.
2.  `matugen` generates a color palette (e.g., in `colors.css`).
3.  A Python script converts specific `matugen` hex colors to `kew`'s 8-bit ANSI color numbers.
4.  A Bash script updates your `kewmusicplayer` config (`kewrc`) with these new ANSI colors.
5.  A notification reminds you to restart `kew` to apply the changes.

## Setup

### Prerequisites

*   **Hyprland**
*   **`matugen`** (configured to output to `/home/j5/.config/waybar/colors.css`)
*   **`kewmusicplayer`**
*   **`python3`**
*   **`notify-send`** (from `libnotify-bin`)
*   Your existing **`wallpaper.sh`** script.

### Steps

1.  **Create `~/.config/kew/hex_to_ansi.py`:**
    ```python
    import sys

    ANSI_COLORS = { # Approximate hex values for 8 standard ANSI colors
        0: (0, 0, 0), 1: (170, 0, 0), 2: (0, 170, 0), 3: (170, 85, 0),
        4: (0, 0, 170), 5: (170, 0, 170), 6: (0, 170, 170), 7: (170, 170, 170)
    }

    def color_distance(rgb1, rgb2): return sum([(c1 - c2) ** 2 for c1, c2 in zip(rgb1, rgb2)]) ** 0.5
    def hex_to_rgb(hex_color): return tuple(int(hex_color.lstrip('#')[i:i+2], 16) for i in (0, 2, 4))

    def find_closest_ansi(hex_color_str):
        target_rgb = hex_to_rgb(hex_color_str)
        closest_color_num, min_distance = -1, float('inf')
        for ansi_num, ansi_rgb in ANSI_COLORS.items():
            dist = color_distance(target_rgb, ansi_rgb)
            if dist < min_distance:
                min_distance, closest_color_num = dist, ansi_num
        return closest_color_num

    if __name__ == "__main__":
        if len(sys.argv) == 2:
            try: print(find_closest_ansi(sys.argv[1]))
            except ValueError: sys.exit(1)
        sys.exit(1)
    ```
    Make executable: `chmod +x ~/.config/kew/hex_to_ansi.py`

2.  **Create `~/.config/hypr/scripts/update_kew_colors.sh`:**
    ```bash
    #!/bin/bash

    # --- Configuration ---
    MATUGEN_COLORS_FILE="/home/j5/.config/waybar/colors.css"
    KEWRC_FILE="/home/j5/.config/kew/kewrc"
    PYTHON_SCRIPT_PATH="/home/j5/.config/kew/hex_to_ansi.py"

    # --- Functions ---
    get_matugen_hex() { grep -m 1 "@define-color $1" "$MATUGEN_COLORS_FILE" | awk '{print $NF}' | tr -d ';'; }
    convert_to_ansi() { [ -n "$1" ] && python3 "$PYTHON_SCRIPT_PATH" "$1" 2>/dev/null; }

    # --- Main Logic ---
    KEW_LOGO_COLOR=$(convert_to_ansi "$(get_matugen_hex "on_background")")
    KEW_ARTIST_COLOR=$(convert_to_ansi "$(get_matugen_hex "primary")")
    KEW_TITLE_COLOR=$(convert_to_ansi "$(get_matugen_hex "primary")")
    KEW_ENQUEUED_COLOR=$(convert_to_ansi "$(get_matugen_hex "secondary")")

    KEW_LOGO_COLOR=${KEW_LOGO_COLOR:-7}
    KEW_ARTIST_COLOR=${KEW_ARTIST_COLOR:-6}
    KEW_TITLE_COLOR=${KEW_TITLE_COLOR:-6}
    KEW_ENQUEUED_COLOR=${KEW_ENQUEUED_COLOR:-2}

    sed -i '/^useConfigColors=/c\useConfigColors=1' "$KEWRC_FILE"
    sed -i "/^color=/c\color=$KEW_LOGO_COLOR" "$KEWRC_FILE"
    sed -i "/^artistColor=/c\artistColor=$KEW_ARTIST_COLOR" "$KEWRC_FILE"
    sed -i "/^titleColor=/c\titleColor=$KEW_TITLE_COLOR" "$KEWRC_FILE"
    sed -i "/^enqueuedColor=/c\enqueuedColor=$KEW_ENQUEUED_COLOR" "$KEWRC_FILE"

    echo "Kew colors in '$KEWRC_FILE' updated based on Matugen theme."
    exit 0
    ```
    **Important:** Verify the `MATUGEN_COLORS_FILE`, `KEWRC_FILE`, and `PYTHON_SCRIPT_PATH` variables match your system's setup.
    Make executable: `chmod +x ~/.config/hypr/scripts/update_kew_colors.sh`

3.  **Configure `~/.config/kew/kewrc`:**
    Ensure `useConfigColors=1` is present in the `[colors]` section. The script will manage the specific color values.

    ```ini
    [colors]
    useConfigColors=1
    # color=X  (these will be overwritten)
    # artistColor=X
    # titleColor=X
    # enqueuedColor=X
    ```

4.  **Modify `/home/j5/.config/hypr/scripts/wallpaper.sh`:**
    Add the following block *after* the `matugen` execution in your wallpaper script:

    ```bash
    # --- Add this section to update Kew colors ---
    KEW_UPDATE_SCRIPT="$HOME/.config/hypr/scripts/update_kew_colors.sh"
    if [ -f "$KEW_UPDATE_SCRIPT" ]; then
        echo ":: Updating Kewmusicplayer colors..."
        bash "$KEW_UPDATE_SCRIPT" & # Run in background
        notify-send "Kew colors updated!" "Please restart kewmusicplayer for changes to apply (pkill kew && kew)" -t 5000
    else
        echo ":: Warning: Kew color update script not found at $KEW_UPDATE_SCRIPT" >&2
    fi
    # --- End of Kew color update section ---
    ```

## Usage

1.  Change your wallpaper as usual.
2.  A desktop notification will appear.
3.  Restart `kewmusicplayer` in your terminal:
    ```bash
    pkill kew && kew
    ```
    Your `kew` instance will now reflect your wallpaper's color scheme!

## Customization & Troubleshooting

*   **Color Mapping:** Adjust how `matugen` colors map to `kew` elements by editing `update_kew_colors.sh` (e.g., change `primary` to `tertiary` for different accent colors).
*   **Issues:** Double-check all script paths, ensure scripts are executable (`chmod +x`), verify `kewrc` has `useConfigColors=1`, and look for errors in your terminal when running `wallpaper.sh`.
